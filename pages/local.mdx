import { Steps, Callout } from 'nextra/components'

# Local MacOS install

<Steps>
### Install [Task](https://taskfile.dev/)

### Install [Rancher Desktop](https://github.com/rancher-sandbox/rancher-desktop/releases)
    
    <Callout type="warning" emoji="⚠️">
    For my local setup, I had to switch the Virtual Machine Emulation to use VZ for Rancher Desktop. Go to Preferences -> Virtual Machine -> Emulation and select VZ.
    </Callout>

### [Cillium for Rancher Desktop](https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#create-the-cluster)
    
    #### Instructions for the override file duplicated below
    
    add `override.yaml` file to the installation directory for Rancher Desktop (`~/Library/Application\ Support/rancher-desktop/lima/_config/`)

    ```yaml copy filename="override.yaml" file=local/override.yaml
    ```

    ```sh copy
    task local:1-add-rd-overwrite
    ```

    Reset Kubernetes through the Diagnostics on the main configuration window in Rancher Desktop.

### Install CRDs for GatewayAPI

    ```sh copy
    task local:2-add-gateway-crds
    ```

### [Install Cilium](https://docs.cilium.io/en/stable/network/servicemesh/gateway-api/gateway-api/#gs-gateway-api) with Gateway API support on the Rancher Desktop Cluster
    
    #### Using [Cilium CLI](https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#install-the-cilium-cli)

    ```sh copy
    task local:3-cilium-install
    ```

### Add Gateway API Class - if its missing from the cluster
    <Callout type="warning" emoji="⚠️">
    In my case, the class was missing from the cluster and cilium operator needs this to create the gateway.
    </Callout>

    ```yaml copy filename="cilium-gateway-class.yaml" file=local/cilium-gateway-class.yaml
    ```

    ```sh copy
    task local:4-add-missing-gateway-class
    ```

### Install Local Gateway 

    ```yaml copy filename="local-gateway.yaml" file=local/local-gateway.yaml
    ```

    ```sh copy
    task local:5-local-gateway-install
    ```

### Install Local Postgres DB

    <Callout type="info" emoji="ℹ️">
    Any local installation will do. 
    </Callout>

    ```sh copy
    task local:6-postgres-install
    ```

### Install Admin Directus

    ```yaml copy filename="admin-values.yaml" file=local/admin-values.yaml
    ```
    
    ```sh copy
    task local:7-admin-install
    ```

### Install API Directus

    ```yaml copy filename="api-values.yaml" file=local/api-values.yaml
    ```
    
    ```sh copy
    task local:8-api-install
    ```

### add gateway to Hosts
    
    ```sh copy
    task local:9-update-hosts
    ```

</Steps>