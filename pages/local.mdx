import { Steps, Callout } from 'nextra/components'

# Local MacOS install

<Steps>
### Install [Rancher Desktop](https://github.com/rancher-sandbox/rancher-desktop/releases)
    
    <Callout type="warning" emoji="⚠️">
    For my local setup i had to switch the Virtual Machine Emulation to use VZ for Rancher Desktop. Go to Preferences -> Virtual Machine -> Emulation and select VZ.
    </Callout>

### [Cillium for Rancher Desktop](https://docs.cilium.io/en/stable/gettingstarted/k8s-install-default/#create-the-cluster)
    
    #### Instructions for the override file duplicated below
    
    add `override.yaml` file to the installation directory for Rancher Desktop (`~/Library/Application\ Support/rancher-desktop/lima/_config/`)

    ```yaml copy filename="override.yaml" file=local/override.yaml
    ```

    ```sh copy
    cp override.yaml ~/Library/Application\ Support/rancher-desktop/lima/_config/override.yaml
    ```

### Install CRDs for GatewayAPI

    ```sh copy
    kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v0.7.0/config/crd/standard/gateway.networking.k8s.io_gatewayclasses.yaml
    kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v0.7.0/config/crd/standard/gateway.networking.k8s.io_gateways.yaml
    kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v0.7.0/config/crd/standard/gateway.networking.k8s.io_httproutes.yaml
    kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v0.7.0/config/crd/standard/gateway.networking.k8s.io_referencegrants.yaml
    kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v0.7.0/config/crd/experimental/gateway.networking.k8s.io_tlsroutes.yaml
    ```

### Install Cilium with Gateway API support on the Rancher Desktop Cluster
    
    [Cilium install](https://docs.cilium.io/en/stable/network/servicemesh/gateway-api/gateway-api/#gs-gateway-api).

    #### Using Cilium CLI

    ```sh copy
    cilium install --version 1.14.2 \
        --set kubeProxyReplacement=true \
        --set gatewayAPI.enabled=true
    ```

### Install Postgres

    ```sh copy
    helm upgrade -i --repo https://garunski-co.github.io/scry-helm-charts/ postgres postgres-local
    ```

### Add Gateway API Class - if its missing from the cluster

    ```yaml copy filename="cilium-gateway-class.yaml" file=local/cilium-gateway-class.yaml
    ```

    ```sh copy
    kubectl apply -f cilium-gateway-class.yaml
    ```

### Install Local Gateway 

    ```yaml copy filename="local-gateway.yaml" file=local/local-gateway.yaml
    ```

    ```sh copy
    kubectl apply -f local-gateway.yaml
    ```

### Install Local Postgres DB

    <Callout type="info" emoji="ℹ️">
    Any local installation will do. 
    </Callout>

    ```sh copy
    helm upgrade -i --repo https://garunski-co.github.io/scry-helm-charts/ postgres postgres-local
    ```

### Install Admin Directus

    ```yaml copy filename="admin-values.yaml" file=local/admin-values.yaml
    ```
    
    ```sh copy
    helm upgrade directus-admin directus-local -i --repo https://garunski-co.github.io/scry-helm-charts/ -f admin-values.yaml
    ```

### Install API Directus

    ```yaml copy filename="api-values.yaml" file=local/api-values.yaml
    ```
    
    ```sh copy
    helm upgrade directus-api directus-local -i --repo https://garunski-co.github.io/scry-helm-charts/ -f api-values.yaml
    ```

### add gateway to Hosts
    run tasks for udpateHosts

</Steps>